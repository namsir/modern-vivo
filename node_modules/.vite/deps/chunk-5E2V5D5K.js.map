{
  "version": 3,
  "sources": ["../../vidstack/dev/chunks/vidstack-BYNmVJLa.js"],
  "sourcesContent": ["import { EventsTarget, DOMEvent, isString, isArray, isNumber } from './vidstack-Bu2kfzUd.js';\nimport { getRequestCredentials } from './vidstack-zG6PIeGg.js';\nimport { isCueActive } from './vidstack-28cU2iGK.js';\n\nconst CROSS_ORIGIN = Symbol(\"TEXT_TRACK_CROSS_ORIGIN\" ), READY_STATE = Symbol(\"TEXT_TRACK_READY_STATE\" ), UPDATE_ACTIVE_CUES = Symbol(\"TEXT_TRACK_UPDATE_ACTIVE_CUES\" ), CAN_LOAD = Symbol(\"TEXT_TRACK_CAN_LOAD\" ), ON_MODE_CHANGE = Symbol(\"TEXT_TRACK_ON_MODE_CHANGE\" ), NATIVE = Symbol(\"TEXT_TRACK_NATIVE\" ), NATIVE_HLS = Symbol(\"TEXT_TRACK_NATIVE_HLS\" );\nconst TextTrackSymbol = {\n  crossOrigin: CROSS_ORIGIN,\n  readyState: READY_STATE,\n  updateActiveCues: UPDATE_ACTIVE_CUES,\n  canLoad: CAN_LOAD,\n  onModeChange: ON_MODE_CHANGE,\n  native: NATIVE,\n  nativeHLS: NATIVE_HLS\n};\n\nclass TextTrack extends EventsTarget {\n  static createId(track) {\n    return `vds-${track.type}-${track.kind}-${track.src ?? track.label ?? \"?\"}`;\n  }\n  src;\n  content;\n  type;\n  encoding;\n  id = \"\";\n  label = \"\";\n  language = \"\";\n  kind;\n  default = false;\n  #canLoad = false;\n  #currentTime = 0;\n  #mode = \"disabled\";\n  #metadata = {};\n  #regions = [];\n  #cues = [];\n  #activeCues = [];\n  /** @internal */\n  [TextTrackSymbol.readyState] = 0;\n  /** @internal */\n  [TextTrackSymbol.crossOrigin];\n  /** @internal */\n  [TextTrackSymbol.onModeChange] = null;\n  /** @internal */\n  [TextTrackSymbol.native] = null;\n  get metadata() {\n    return this.#metadata;\n  }\n  get regions() {\n    return this.#regions;\n  }\n  get cues() {\n    return this.#cues;\n  }\n  get activeCues() {\n    return this.#activeCues;\n  }\n  /**\n   * - 0: Not Loading\n   * - 1: Loading\n   * - 2: Ready\n   * - 3: Error\n   */\n  get readyState() {\n    return this[TextTrackSymbol.readyState];\n  }\n  get mode() {\n    return this.#mode;\n  }\n  set mode(mode) {\n    this.setMode(mode);\n  }\n  constructor(init) {\n    super();\n    for (const prop of Object.keys(init)) this[prop] = init[prop];\n    if (!this.type) this.type = \"vtt\";\n    if (init.content) {\n      this.#parseContent(init);\n    } else if (!init.src) {\n      this[TextTrackSymbol.readyState] = 2;\n    }\n    if (isTrackCaptionKind(this) && !this.label) {\n      console.warn(`[vidstack] captions text track created without label: \\`${this.src}\\``);\n    }\n  }\n  addCue(cue, trigger) {\n    let i = 0, length = this.#cues.length;\n    for (i = 0; i < length; i++) if (cue.endTime <= this.#cues[i].startTime) break;\n    if (i === length) this.#cues.push(cue);\n    else this.#cues.splice(i, 0, cue);\n    if (!(cue instanceof TextTrackCue)) {\n      this[TextTrackSymbol.native]?.track.addCue(cue);\n    }\n    this.dispatchEvent(new DOMEvent(\"add-cue\", { detail: cue, trigger }));\n    if (isCueActive(cue, this.#currentTime)) {\n      this[TextTrackSymbol.updateActiveCues](this.#currentTime, trigger);\n    }\n  }\n  removeCue(cue, trigger) {\n    const index = this.#cues.indexOf(cue);\n    if (index >= 0) {\n      const isActive = this.#activeCues.includes(cue);\n      this.#cues.splice(index, 1);\n      this[TextTrackSymbol.native]?.track.removeCue(cue);\n      this.dispatchEvent(new DOMEvent(\"remove-cue\", { detail: cue, trigger }));\n      if (isActive) {\n        this[TextTrackSymbol.updateActiveCues](this.#currentTime, trigger);\n      }\n    }\n  }\n  setMode(mode, trigger) {\n    if (this.#mode === mode) return;\n    this.#mode = mode;\n    if (mode === \"disabled\") {\n      this.#activeCues = [];\n      this.#activeCuesChanged();\n    } else if (this.readyState === 2) {\n      this[TextTrackSymbol.updateActiveCues](this.#currentTime, trigger);\n    } else {\n      this.#load();\n    }\n    this.dispatchEvent(new DOMEvent(\"mode-change\", { detail: this, trigger }));\n    this[TextTrackSymbol.onModeChange]?.();\n  }\n  /** @internal */\n  [TextTrackSymbol.updateActiveCues](currentTime, trigger) {\n    this.#currentTime = currentTime;\n    if (this.mode === \"disabled\" || !this.#cues.length) return;\n    const activeCues = [];\n    for (let i = 0, length = this.#cues.length; i < length; i++) {\n      const cue = this.#cues[i];\n      if (isCueActive(cue, currentTime)) activeCues.push(cue);\n    }\n    let changed = activeCues.length !== this.#activeCues.length;\n    if (!changed) {\n      for (let i = 0; i < activeCues.length; i++) {\n        if (!this.#activeCues.includes(activeCues[i])) {\n          changed = true;\n          break;\n        }\n      }\n    }\n    this.#activeCues = activeCues;\n    if (changed) this.#activeCuesChanged(trigger);\n  }\n  /** @internal */\n  [TextTrackSymbol.canLoad]() {\n    this.#canLoad = true;\n    if (this.#mode !== \"disabled\") this.#load();\n  }\n  #parseContent(init) {\n    import('media-captions').then(({ parseText, VTTCue, VTTRegion }) => {\n      if (!isString(init.content) || init.type === \"json\") {\n        this.#parseJSON(init.content, VTTCue, VTTRegion);\n        if (this.readyState !== 3) this.#ready();\n      } else {\n        parseText(init.content, { type: init.type }).then(({ cues, regions }) => {\n          this.#cues = cues;\n          this.#regions = regions;\n          this.#ready();\n        });\n      }\n    });\n  }\n  async #load() {\n    if (!this.#canLoad || this[TextTrackSymbol.readyState] > 0) return;\n    this[TextTrackSymbol.readyState] = 1;\n    this.dispatchEvent(new DOMEvent(\"load-start\"));\n    if (!this.src) {\n      this.#ready();\n      return;\n    }\n    try {\n      const { parseResponse, VTTCue, VTTRegion } = await import('media-captions'), crossOrigin = this[TextTrackSymbol.crossOrigin]?.();\n      const response = fetch(this.src, {\n        headers: this.type === \"json\" ? { \"Content-Type\": \"application/json\" } : void 0,\n        credentials: getRequestCredentials(crossOrigin)\n      });\n      if (this.type === \"json\") {\n        this.#parseJSON(await (await response).text(), VTTCue, VTTRegion);\n      } else {\n        const { errors, metadata, regions, cues } = await parseResponse(response, {\n          type: this.type,\n          encoding: this.encoding\n        });\n        if (errors[0]?.code === 0) {\n          throw errors[0];\n        } else {\n          this.#metadata = metadata;\n          this.#regions = regions;\n          this.#cues = cues;\n        }\n      }\n      this.#ready();\n    } catch (error) {\n      this.#error(error);\n    }\n  }\n  #ready() {\n    this[TextTrackSymbol.readyState] = 2;\n    if (!this.src || this.type !== \"vtt\") {\n      const native = this[TextTrackSymbol.native];\n      if (native && !native.managed) {\n        for (const cue of this.#cues) native.track.addCue(cue);\n      }\n    }\n    const loadEvent = new DOMEvent(\"load\");\n    this[TextTrackSymbol.updateActiveCues](this.#currentTime, loadEvent);\n    this.dispatchEvent(loadEvent);\n  }\n  #error(error) {\n    this[TextTrackSymbol.readyState] = 3;\n    this.dispatchEvent(new DOMEvent(\"error\", { detail: error }));\n  }\n  #parseJSON(json, VTTCue, VTTRegion) {\n    try {\n      const { regions, cues } = parseJSONCaptionsFile(json, VTTCue, VTTRegion);\n      this.#regions = regions;\n      this.#cues = cues;\n    } catch (error) {\n      {\n        console.error(`[vidstack] failed to parse JSON captions at: \\`${this.src}\\`\n\n`, error);\n      }\n      this.#error(error);\n    }\n  }\n  #activeCuesChanged(trigger) {\n    this.dispatchEvent(new DOMEvent(\"cue-change\", { trigger }));\n  }\n}\nconst captionRE = /captions|subtitles/;\nfunction isTrackCaptionKind(track) {\n  return captionRE.test(track.kind);\n}\nfunction parseJSONCaptionsFile(json, Cue, Region) {\n  const content = isString(json) ? JSON.parse(json) : json;\n  let regions = [], cues = [];\n  if (content.regions && Region) {\n    regions = content.regions.map((region) => Object.assign(new Region(), region));\n  }\n  if (content.cues || isArray(content)) {\n    cues = (isArray(content) ? content : content.cues).filter((content2) => isNumber(content2.startTime) && isNumber(content2.endTime)).map((cue) => Object.assign(new Cue(0, 0, \"\"), cue));\n  }\n  return { regions, cues };\n}\n\nexport { TextTrack, TextTrackSymbol, isTrackCaptionKind, parseJSONCaptionsFile };\n"],
  "mappings": "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",
  "names": []
}
