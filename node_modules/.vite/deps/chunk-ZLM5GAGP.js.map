{
  "version": 3,
  "sources": ["../../vidstack/dev/providers/vidstack-video.js"],
  "sourcesContent": ["import { onDispose, EventsController, listenEvent, DOMEvent, scoped } from '../chunks/vidstack-Bu2kfzUd.js';\nimport { canUsePictureInPicture, canUseVideoPresentation, canPlayHLSNatively } from '../chunks/vidstack-CjhKISI0.js';\nimport { HTMLMediaProvider } from './vidstack-html.js';\nimport { HTMLAirPlayAdapter } from '../chunks/vidstack-Bo5OTJ06.js';\nimport { TextTrack, TextTrackSymbol } from '../chunks/vidstack-BYNmVJLa.js';\nimport '../chunks/vidstack-qh1N5_f_.js';\nimport '../chunks/vidstack-Dihypf8P.js';\nimport '../chunks/vidstack-Dv_LIPFu.js';\nimport '../chunks/vidstack-zG6PIeGg.js';\nimport '../chunks/vidstack-28cU2iGK.js';\n\nclass NativeHLSTextTracks {\n  #video;\n  #ctx;\n  constructor(video, ctx) {\n    this.#video = video;\n    this.#ctx = ctx;\n    video.textTracks.onaddtrack = this.#onAddTrack.bind(this);\n    onDispose(this.#onDispose.bind(this));\n  }\n  #onAddTrack(event) {\n    const nativeTrack = event.track;\n    if (!nativeTrack || findTextTrackElement(this.#video, nativeTrack)) return;\n    const track = new TextTrack({\n      id: nativeTrack.id,\n      kind: nativeTrack.kind,\n      label: nativeTrack.label ?? \"\",\n      language: nativeTrack.language,\n      type: \"vtt\"\n    });\n    track[TextTrackSymbol.native] = { track: nativeTrack };\n    track[TextTrackSymbol.readyState] = 2;\n    track[TextTrackSymbol.nativeHLS] = true;\n    let lastIndex = 0;\n    const onCueChange = (event2) => {\n      if (!nativeTrack.cues) return;\n      for (let i = lastIndex; i < nativeTrack.cues.length; i++) {\n        track.addCue(nativeTrack.cues[i], event2);\n        lastIndex++;\n      }\n    };\n    onCueChange(event);\n    nativeTrack.oncuechange = onCueChange;\n    this.#ctx.textTracks.add(track, event);\n    track.setMode(nativeTrack.mode, event);\n  }\n  #onDispose() {\n    this.#video.textTracks.onaddtrack = null;\n    for (const track of this.#ctx.textTracks) {\n      const nativeTrack = track[TextTrackSymbol.native]?.track;\n      if (nativeTrack?.oncuechange) nativeTrack.oncuechange = null;\n    }\n  }\n}\nfunction findTextTrackElement(video, track) {\n  return Array.from(video.children).find((el) => el.track === track);\n}\n\nclass VideoPictureInPicture {\n  #video;\n  #media;\n  constructor(video, media) {\n    this.#video = video;\n    this.#media = media;\n    new EventsController(video).add(\"enterpictureinpicture\", this.#onEnter.bind(this)).add(\"leavepictureinpicture\", this.#onExit.bind(this));\n  }\n  get active() {\n    return document.pictureInPictureElement === this.#video;\n  }\n  get supported() {\n    return canUsePictureInPicture(this.#video);\n  }\n  async enter() {\n    return this.#video.requestPictureInPicture();\n  }\n  exit() {\n    return document.exitPictureInPicture();\n  }\n  #onEnter(event) {\n    this.#onChange(true, event);\n  }\n  #onExit(event) {\n    this.#onChange(false, event);\n  }\n  #onChange = (active, event) => {\n    this.#media.notify(\"picture-in-picture-change\", active, event);\n  };\n}\n\nclass VideoPresentation {\n  #video;\n  #media;\n  #mode = \"inline\";\n  get mode() {\n    return this.#mode;\n  }\n  constructor(video, media) {\n    this.#video = video;\n    this.#media = media;\n    listenEvent(video, \"webkitpresentationmodechanged\", this.#onModeChange.bind(this));\n  }\n  get supported() {\n    return canUseVideoPresentation(this.#video);\n  }\n  async setPresentationMode(mode) {\n    if (this.#mode === mode) return;\n    this.#video.webkitSetPresentationMode(mode);\n  }\n  #onModeChange(event) {\n    const prevMode = this.#mode;\n    this.#mode = this.#video.webkitPresentationMode;\n    {\n      this.#media.logger?.infoGroup(\"presentation mode change\").labelledLog(\"Mode\", this.#mode).labelledLog(\"Event\", event).dispatch();\n    }\n    this.#media.player?.dispatch(\n      new DOMEvent(\"video-presentation-change\", {\n        detail: this.#mode,\n        trigger: event\n      })\n    );\n    [\"fullscreen\", \"picture-in-picture\"].forEach((type) => {\n      if (this.#mode === type || prevMode === type) {\n        this.#media.notify(`${type}-change`, this.#mode === type, event);\n      }\n    });\n  }\n}\nclass FullscreenPresentationAdapter {\n  #presentation;\n  get active() {\n    return this.#presentation.mode === \"fullscreen\";\n  }\n  get supported() {\n    return this.#presentation.supported;\n  }\n  constructor(presentation) {\n    this.#presentation = presentation;\n  }\n  async enter() {\n    this.#presentation.setPresentationMode(\"fullscreen\");\n  }\n  async exit() {\n    this.#presentation.setPresentationMode(\"inline\");\n  }\n}\nclass PIPPresentationAdapter {\n  #presentation;\n  get active() {\n    return this.#presentation.mode === \"picture-in-picture\";\n  }\n  get supported() {\n    return this.#presentation.supported;\n  }\n  constructor(presentation) {\n    this.#presentation = presentation;\n  }\n  async enter() {\n    this.#presentation.setPresentationMode(\"picture-in-picture\");\n  }\n  async exit() {\n    this.#presentation.setPresentationMode(\"inline\");\n  }\n}\n\nclass VideoProvider extends HTMLMediaProvider {\n  $$PROVIDER_TYPE = \"VIDEO\";\n  get type() {\n    return \"video\";\n  }\n  airPlay;\n  fullscreen;\n  pictureInPicture;\n  constructor(video, ctx) {\n    super(video, ctx);\n    scoped(() => {\n      this.airPlay = new HTMLAirPlayAdapter(video, ctx);\n      if (canUseVideoPresentation(video)) {\n        const presentation = new VideoPresentation(video, ctx);\n        this.fullscreen = new FullscreenPresentationAdapter(presentation);\n        this.pictureInPicture = new PIPPresentationAdapter(presentation);\n      } else if (canUsePictureInPicture(video)) {\n        this.pictureInPicture = new VideoPictureInPicture(video, ctx);\n      }\n    }, this.scope);\n  }\n  setup() {\n    super.setup();\n    if (canPlayHLSNatively(this.video)) {\n      new NativeHLSTextTracks(this.video, this.ctx);\n    }\n    this.ctx.textRenderers.attachVideo(this.video);\n    onDispose(() => {\n      this.ctx.textRenderers.attachVideo(null);\n    });\n    if (this.type === \"video\") this.ctx.notify(\"provider-setup\", this);\n  }\n  /**\n   * The native HTML `<video>` element.\n   *\n   * @see {@link https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement}\n   */\n  get video() {\n    return this.media;\n  }\n}\n\nexport { VideoProvider };\n"],
  "mappings": "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",
  "names": []
}
